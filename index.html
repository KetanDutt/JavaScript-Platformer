<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="description" content="Platformer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

    <!-- iOS meta tags & icons -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Platformer">

    <title>Platformer</title>

    <link rel="apple-touch-icon" href="icons/Icon-192.png">
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript" src="engine.js"></script>
</head>

<body onresize="resizeWindow()"
    style="-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;"
    unselectable="on" onselectstart="return false;">
    <canvas id="canvas"></canvas>

    <div id="buttons">
        <button onclick="openFullscreen()" ontouchstart="game.keydown({ keyCode: 37 })"
            ontouchend="game.keyup({ keyCode: 37 })" ontouchcancel="game.keyup({ keyCode: 37 })"
            onmousedown=" game.keydown({ keyCode: 37 })" onmouseup=" game.keyup({ keyCode: 37 })"> &lt; </button>
        <button onclick="openFullscreen()" ontouchstart="game.keydown({ keyCode: 39 })"
            ontouchend="game.keyup({ keyCode: 39 })" ontouchcancel="game.keyup({ keyCode: 39 })"
            onmousedown=" game.keydown({ keyCode: 39 })" onmouseup=" game.keyup({ keyCode: 39 })">></button>
        <button onclick="openFullscreen()" ontouchstart="game.keydown({ keyCode: 38 })"
            ontouchend="game.keyup({ keyCode: 38 })" ontouchcancel="game.keyup({ keyCode: 38 })"
            onmousedown=" game.keydown({ keyCode: 38 })" onmouseup=" game.keyup({ keyCode: 38 })">^</button>
    </div>
    <script type="text/javascript">
        function resizeWindow() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            game.set_viewport(canvas.width, canvas.height);
            game.load_map(map);
        }

        window.requestAnimFrame =
            window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            function (callback) {
                return window.setTimeout(callback, 1000 / 60);
            };

        var canvas = document.getElementById('canvas'),
            ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        /* Setup of the engine */


        /* Limit the viewport to the confines of the map */

        var elem = document.documentElement;

        /* View in fullscreen */
        function openFullscreen() {
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.mozRequestFullScreen) { /* Firefox */
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE/Edge */
                elem.msRequestFullscreen();
            }
        }

        /* Close fullscreen */
        function closeFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) { /* Firefox */
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE/Edge */
                document.msExitFullscreen();
            }
        }



        /* Start */
        async function gameStart() {
            var game = new Engine();
            game.set_viewport(canvas.width, canvas.height);
            map = await fetch('level1.json').then(response => response.json());
            game.load_map(map);


            game.limit_viewport = true;

            var Loop = function () {

                ctx.fillStyle = '#333';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                game.update();
                game.draw(ctx);

                window.requestAnimFrame(Loop);
            };

            Loop();
        }
        gameStart();

    </script>
</body>

</html>